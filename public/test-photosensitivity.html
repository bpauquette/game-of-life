<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game of Life - Photosensitivity Test</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { color: #00ff00; border-bottom: 2px solid #00ff00; padding-bottom: 10px; }
        .instructions {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #00aaff;
        }
        .test-controls {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 12px 24px;
            margin: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            border-radius: 4px;
        }
        button:hover { background: #00cc00; }
        button.primary { background: #00aaff; }
        #results {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-size: 12px;
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .pass { color: #00ff00; }
        .fail { color: #ff3333; }
        .warning { color: #ffaa00; }
        .info { color: #00aaff; }
        .test-status {
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #00ff00;
            background: #2a2a2a;
            font-size: 14px;
        }
        .test-status.running { border-left-color: #ffaa00; }
        .test-status.passed { border-left-color: #00ff00; }
        .test-status.failed { border-left-color: #ff3333; }
        code {
            background: #000;
            padding: 2px 6px;
            border-radius: 3px;
            color: #00ff00;
        }
    </style>
</head>
<body>
    <h1>üß™ Game of Life - Photosensitivity Safety Test</h1>
    
    <div class="instructions">
        <h2>üìã Testing Instructions</h2>
        <p><strong>This tool tests if the Game of Life animation meets WCAG 2.1 accessibility standards for photosensitive seizure prevention.</strong></p>
        
        <h3>Quick Test (Browser Console):</h3>
        <ol>
            <li>Open the main Game of Life page (click "Return to App" below)</li>
            <li>Press <code>F12</code> to open browser console</li>
            <li>Copy and paste the minified test script below</li>
            <li>Wait 10 seconds for automatic analysis</li>
            <li>Review PASS/FAIL result in console</li>
        </ol>
        
        <h3>What This Tests:</h3>
        <ul>
            <li>‚úÖ <strong>Flash Rate:</strong> Max 3 flashes per second (WCAG 2.1 Level A)</li>
            <li>‚úÖ <strong>Flash Area:</strong> Flashing area ‚â§ 87,296 pixels (341√ó256 rectangle)</li>
            <li>‚úÖ <strong>Red Flash Detection:</strong> Dangerous saturated red transitions</li>
            <li>‚úÖ <strong>Luminance Changes:</strong> ITU-R BT.1702 relative luminance calculations</li>
        </ul>
        
        <h3>Legal Compliance:</h3>
        <p>‚öñÔ∏è Meeting WCAG 2.1 Level A provides <strong>safe harbor protection</strong> under ADA regulations. Violations may result in legal liability for photosensitive seizures.</p>
    </div>
    
    <div class="test-controls">
        <h2>üöÄ Test Methods</h2>
        
        <button class="primary" onclick="window.open('/', '_self')">
            üéÆ Return to App
        </button>
        
        <button onclick="copyTestScript()">
            üìã Copy Browser Console Test Script
        </button>
        
        <button onclick="showConsoleInstructions()">
            üìñ Show Console Test Instructions
        </button>
        
        <button onclick="window.location.reload()">Clear Results</button>
    </div>
    
    <div id="status" class="test-status">
        Ready to test. Click "Copy Browser Console Test Script" above.
    </div>
    
    <div id="results">
<strong>Test Script (Copy and Paste into Browser Console):</strong>

Click "Copy Browser Console Test Script" button to copy this to clipboard.
Then open the main app and paste it into the console (F12).
    </div>

    <script>
        // Minified test script
        const testScript = `(function(){class LivePhotosensitivityTest{constructor(){this.canvas=null;this.ctx=null;this.frames=[];this.flashEvents=[];this.startTime=0;this.testDuration=10000;this.sampleInterval=33;this.maxFlashRate=3;this.maxFlashArea=87296}async start(){console.log("üß™ Starting photosensitivity test...");this.canvas=document.querySelector("canvas");if(!this.canvas){console.error("‚ùå No canvas found");return}this.ctx=this.canvas.getContext("2d");this.startTime=Date.now();const intervalId=setInterval(()=>{this.captureFrame()},this.sampleInterval);setTimeout(()=>{clearInterval(intervalId);this.analyze()},this.testDuration)}captureFrame(){try{const imageData=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height);this.frames.push({timestamp:Date.now(),data:imageData})}catch(e){console.warn("Frame capture failed:",e)}}detectFlash(prevFrame,currFrame){if(!prevFrame||!currFrame)return null;const prev=prevFrame.data.data;const curr=currFrame.data.data;let flashPixels=0;for(let i=0;i<prev.length;i+=4){const prevL=(0.2126*prev[i]+0.7152*prev[i+1]+0.0722*prev[i+2])/255;const currL=(0.2126*curr[i]+0.7152*curr[i+1]+0.0722*curr[i+2])/255;const delta=Math.abs(currL-prevL);if(delta>0.08){flashPixels++}}if(flashPixels>1000){return{timestamp:currFrame.timestamp,flashPixels:flashPixels}}return null}analyze(){console.log("\\nüìä Analyzing",this.frames.length,"captured frames...");for(let i=1;i<this.frames.length;i++){const flash=this.detectFlash(this.frames[i-1],this.frames[i]);if(flash){this.flashEvents.push(flash)}}const oneSecondAgo=Date.now()-1000;const recentFlashes=this.flashEvents.filter(f=>f.timestamp>oneSecondAgo);const flashRate=recentFlashes.length;const maxFlashArea=Math.max(...this.flashEvents.map(f=>f.flashPixels),0);const flashRateViolation=flashRate>this.maxFlashRate;const flashAreaViolation=maxFlashArea>this.maxFlashArea;const wcagCompliant=!flashRateViolation&&!flashAreaViolation;const report=this.getReport(wcagCompliant,flashRate,maxFlashArea,flashRateViolation,flashAreaViolation);console.log(report);window.__PHOTOSENSITIVITY_REPORT__=report;return report}getReport(compliant,rate,area,rateViolation,areaViolation){const border="=".repeat(60);let report=border+"\\n";report+="  PHOTOSENSITIVITY TEST RESULTS\\n";report+=border+"\\n\\n";if(compliant){report+="‚úÖ RESULT: PASS - Animation is WCAG 2.1 Level A compliant\\n"}else{report+="‚ùå RESULT: FAIL - WCAG 2.1 violations detected\\n"}report+="\\nüìä MEASUREMENTS:\\n";report+="  Flash Rate: "+rate+"/sec (limit: "+this.maxFlashRate+"/sec) ";report+=rateViolation?"‚ùå VIOLATION\\n":"‚úÖ\\n";report+="  Flash Area: "+area+" pixels (limit: "+this.maxFlashArea+" px) ";report+=areaViolation?"‚ùå VIOLATION\\n":"‚úÖ\\n";report+="  Frames Analyzed: "+this.frames.length+"\\n";report+="  Flash Events: "+this.flashEvents.length+"\\n";if(!compliant){report+="\\n‚ö†Ô∏è RECOMMENDATIONS:\\n";if(rateViolation){report+="  ‚Ä¢ Reduce animation speed to max 2 fps\\n";report+="  ‚Ä¢ Implement frame delay between updates\\n"}if(areaViolation){report+="  ‚Ä¢ Reduce visible grid size (<50√ó50 cells)\\n";report+="  ‚Ä¢ Use gradual transitions instead of instant changes\\n"}report+="\\n‚öñÔ∏è LEGAL STATUS: HIGH RISK - Not ADA compliant\\n"}else{report+="\\n‚öñÔ∏è LEGAL STATUS: LOW RISK - Safe harbor protection\\n"}report+="\\n"+border;return report}}const test=new LivePhotosensitivityTest();test.start();console.log("‚è≥ Test running for 10 seconds... Please wait...");})();`;

        function copyTestScript() {
            navigator.clipboard.writeText(testScript).then(() => {
                setStatus('‚úÖ Test script copied to clipboard! Now open the main app and paste into console (F12)', 'passed');
                showInResults('SUCCESS', 'Script copied to clipboard!\\n\\nNext steps:\\n1. Click "Return to App" button above\\n2. Press F12 to open console\\n3. Paste the script and press Enter\\n4. Wait 10 seconds\\n5. Review PASS/FAIL results');
            }).catch(err => {
                setStatus('‚ùå Failed to copy. Please copy manually from results area.', 'failed');
                showInResults('ERROR', 'Auto-copy failed. Please manually select and copy the script below:\\n\\n' + testScript);
            });
        }

        function showConsoleInstructions() {
            const instructions = \`
üìñ CONSOLE TEST INSTRUCTIONS
${'='.repeat(60)}

STEP 1: Return to Main App
  ‚Ä¢ Click "Return to App" button above
  ‚Ä¢ Or navigate to the main Game of Life page

STEP 2: Open Browser Console
  ‚Ä¢ Press F12 (Windows/Linux)
  ‚Ä¢ Or Cmd+Option+J (Mac)
  ‚Ä¢ Or Right-click ‚Üí Inspect ‚Üí Console tab

STEP 3: Copy & Paste Test Script
  ‚Ä¢ Click "Copy Browser Console Test Script" button
  ‚Ä¢ Paste into console and press Enter
  ‚Ä¢ Script will auto-run for 10 seconds

STEP 4: Review Results
  ‚Ä¢ Console will show "Test running for 10 seconds..."
  ‚Ä¢ After 10 seconds, results appear automatically
  ‚Ä¢ Look for ‚úÖ PASS or ‚ùå FAIL

STEP 5: Interpret Results
  ‚Ä¢ PASS = WCAG 2.1 compliant, legally safe
  ‚Ä¢ FAIL = Violations detected, see recommendations
  ‚Ä¢ Results saved to window.__PHOTOSENSITIVITY_REPORT__

${'='.repeat(60)}

WHAT IT TESTS:
  ‚úì Flash rate (max 3/second)
  ‚úì Flash area (max 87,296 pixels)
  ‚úì Luminance changes (ITU-R BT.1702)

LEGAL COMPLIANCE:
  ‚öñÔ∏è PASS = Safe harbor under ADA
  ‚öñÔ∏è FAIL = Legal liability risk for seizures
            \`;
            
            showInResults('INSTRUCTIONS', instructions);
            setStatus('üìñ Instructions displayed below. Copy the test script and follow the steps.', 'info');
        }

        function setStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'test-status ' + type;
        }

        function showInResults(title, content) {
            const results = document.getElementById('results');
            results.innerHTML = '<strong>' + title + ':</strong>\\n\\n' + content;
        }

        // Auto-show instructions on load
        window.addEventListener('load', () => {
            showConsoleInstructions();
        });
    </script>
</body>
</html>
